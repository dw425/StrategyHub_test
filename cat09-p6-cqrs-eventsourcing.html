<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CQRS & Event Sourcing | Architecture Patterns | Strategy Hub</title>
    <style>
        :root {
            --brand-orange: #FF9900;
            --cat-primary: #6366F1;
            --cat-light: #818CF8;
            --cat-dark: #4F46E5;
            --cat-glow: rgba(99, 102, 241, 0.15);
            --page-color: #8B5CF6;
            --page-light: #A78BFA;
            --page-glow: rgba(139, 92, 246, 0.15);
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-alt: #1a1a2e;
            --bg-hover: #252538;
            --border-color: #2a2a3e;
            --text-primary: #ffffff;
            --text-secondary: #a0a0b0;
            --text-muted: #6a6a7a;
            --green: #10B981;
            --yellow: #F59E0B;
            --red: #EF4444;
            --blue: #3B82F6;
            --cyan: #06B6D4;
            --purple: #8B5CF6;
            --pink: #EC4899;
            --sidebar-width: 280px;
            --header-height: 60px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-dark); color: var(--text-primary); line-height: 1.6; }
        
        header { background: var(--bg-card); border-bottom: 1px solid var(--border-color); padding: 0 32px; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; height: var(--header-height); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 20px; font-weight: 700; text-decoration: none; color: inherit; }
        .logo span { color: var(--brand-orange); }
        .breadcrumb { display: flex; align-items: center; gap: 8px; font-size: 14px; }
        .breadcrumb a { color: var(--text-secondary); text-decoration: none; }
        .breadcrumb a:hover { color: var(--brand-orange); }
        .breadcrumb .sep { color: var(--text-muted); }
        .breadcrumb .current { color: var(--text-primary); }

        .sidebar { position: fixed; top: var(--header-height); left: 0; width: var(--sidebar-width); height: calc(100vh - var(--header-height)); background: var(--bg-card); border-right: 1px solid var(--border-color); overflow-y: auto; z-index: 100; padding: 24px 0; }
        .sidebar-section { margin-bottom: 24px; }
        .sidebar-title { font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; color: var(--cat-light); padding: 0 24px; margin-bottom: 8px; }
        .sidebar-nav { list-style: none; }
        .sidebar-nav a { display: flex; align-items: center; gap: 8px; padding: 10px 24px; color: var(--text-secondary); text-decoration: none; font-size: 13px; border-left: 3px solid transparent; transition: all 0.2s; }
        .sidebar-nav a:hover { background: var(--bg-hover); color: var(--text-primary); }
        .sidebar-nav a.active { background: var(--cat-glow); color: var(--cat-light); border-left-color: var(--cat-light); }
        .nav-icon { font-size: 16px; width: 24px; text-align: center; }

        .main-wrapper { margin-left: var(--sidebar-width); margin-top: var(--header-height); }
        .main-content { max-width: 1200px; padding: 32px; }

        /* Hero */
        .hero { margin-bottom: 28px; padding: 28px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 14px; position: relative; }
        .hero::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #8B5CF6, #EC4899, #06B6D4); border-radius: 14px 14px 0 0; }
        .hero-tag { display: inline-flex; background: var(--page-glow); border: 1px solid var(--page-color); padding: 5px 14px; border-radius: 9999px; font-size: 11px; color: var(--page-light); margin-bottom: 14px; }
        .hero h1 { font-size: 28px; font-weight: 700; margin-bottom: 12px; }
        .hero > p { font-size: 14px; color: var(--text-secondary); line-height: 1.7; max-width: 800px; margin-bottom: 24px; }
        .hero-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; }
        .hero-stat { background: var(--bg-card-alt); border: 1px solid var(--border-color); border-radius: 10px; padding: 16px; text-align: center; }
        .hero-stat-value { font-size: 22px; font-weight: 700; color: var(--page-light); }
        .hero-stat-label { font-size: 10px; color: var(--text-muted); margin-top: 4px; }

        /* Business Case */
        .business-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .business-card { background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; text-align: center; }
        .business-icon { font-size: 28px; margin-bottom: 8px; }
        .business-stat { font-size: 28px; font-weight: 700; color: var(--page-light); margin-bottom: 4px; }
        .business-label { font-size: 12px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
        .business-desc { font-size: 11px; color: var(--text-secondary); line-height: 1.5; }

        /* Architecture Diagram */
        .architecture-diagram { background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .arch-svg { width: 100%; height: auto; }
        
        .flow-explanation { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .flow-step { display: flex; align-items: flex-start; gap: 12px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px 16px; }
        .step-num { width: 24px; height: 24px; background: var(--page-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; flex-shrink: 0; }
        .step-text { font-size: 12px; color: var(--text-secondary); line-height: 1.5; }
        .step-text strong { color: var(--text-primary); }

        /* Pattern Cards */
        .pattern-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 24px; }
        .pattern-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; }
        .pattern-card.cqrs { border-top: 4px solid #8B5CF6; }
        .pattern-card.es { border-top: 4px solid #EC4899; }
        .pattern-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
        .pattern-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .pattern-card.cqrs .pattern-icon { background: rgba(139, 92, 246, 0.2); }
        .pattern-card.es .pattern-icon { background: rgba(236, 72, 153, 0.2); }
        .pattern-title h3 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .pattern-card.cqrs .pattern-title h3 { color: #A78BFA; }
        .pattern-card.es .pattern-title h3 { color: #F472B6; }
        .pattern-title .tagline { font-size: 11px; color: var(--text-muted); }
        .pattern-desc { font-size: 13px; color: var(--text-secondary); line-height: 1.7; margin-bottom: 16px; }
        .pattern-features { display: flex; flex-wrap: wrap; gap: 8px; }
        .pattern-feature { font-size: 10px; padding: 4px 10px; background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 4px; color: var(--text-secondary); }

        /* Code Block */
        .code-block { background: var(--bg-dark); border-radius: 8px; padding: 16px; margin-bottom: 16px; font-family: 'Monaco', 'Menlo', monospace; font-size: 12px; overflow-x: auto; }
        .code-block .comment { color: #6A737D; }
        .code-block .keyword { color: #FF7B72; }
        .code-block .string { color: #A5D6FF; }
        .code-block .class { color: #F59E0B; }
        .code-block .method { color: #10B981; }

        /* Comparison */
        .compare-table { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; margin-bottom: 24px; }
        .compare-header { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr; background: var(--bg-card-alt); padding: 16px; border-bottom: 1px solid var(--border-color); }
        .compare-col { font-size: 12px; text-align: center; font-weight: 600; }
        .compare-col.traditional { color: var(--yellow); }
        .compare-col.cqrs { color: #A78BFA; }
        .compare-col.cqrs-es { color: #EC4899; }
        .compare-row { display: grid; grid-template-columns: 1.5fr 1fr 1fr 1fr; padding: 14px 16px; border-bottom: 1px solid var(--border-color); align-items: center; }
        .compare-row:last-child { border-bottom: none; }
        .compare-row .compare-col:first-child { text-align: left; font-weight: 600; font-size: 12px; color: var(--text-primary); }
        .compare-cell { text-align: center; font-size: 11px; }
        .cell-good { color: var(--green); }
        .cell-bad { color: var(--red); }
        .cell-mid { color: var(--yellow); }

        /* Module */
        .module { margin-bottom: 40px; padding-top: 28px; border-top: 1px solid var(--border-color); }
        .module:first-of-type { border-top: none; padding-top: 0; }
        .module-header { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; }
        .module-icon { width: 52px; height: 52px; background: var(--page-glow); border: 2px solid var(--page-color); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .module-info h2 { font-size: 22px; font-weight: 600; margin-bottom: 4px; }
        .module-info p { font-size: 13px; color: var(--text-muted); }

        /* Content Block */
        .content-block { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 24px; margin-bottom: 20px; }
        .content-block h3 { font-size: 16px; font-weight: 600; margin-bottom: 14px; color: var(--page-light); }
        .content-block p { font-size: 13px; color: var(--text-secondary); line-height: 1.7; margin-bottom: 12px; }
        .content-block p:last-child { margin-bottom: 0; }
        .content-block p strong { color: var(--text-primary); }

        /* Two Column */
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
        .info-box { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; }
        .info-box h4 { font-size: 14px; font-weight: 600; margin-bottom: 12px; color: var(--text-primary); display: flex; align-items: center; gap: 10px; }
        .info-box h4::before { content: ''; width: 3px; height: 16px; background: var(--page-color); border-radius: 2px; }
        .info-list { list-style: none; margin: 0; padding: 0; }
        .info-list li { font-size: 12px; color: var(--text-secondary); padding: 8px 0; border-bottom: 1px solid var(--border-color); line-height: 1.5; }
        .info-list li:last-child { border-bottom: none; }
        .info-list li strong { color: var(--text-primary); }

        /* Use Cases */
        .use-cases-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .use-case-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; text-align: center; }
        .use-case-icon { font-size: 32px; margin-bottom: 12px; }
        .use-case-name { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
        .use-case-desc { font-size: 11px; color: var(--text-muted); line-height: 1.5; }

        /* Best Practices */
        .bp-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; margin-bottom: 24px; }
        .bp-card { background: var(--bg-dark); border-radius: 12px; padding: 24px; }
        .bp-card.do { border: 1px solid var(--green); }
        .bp-card.dont { border: 1px solid var(--red); }
        .bp-title { font-size: 16px; font-weight: 600; margin-bottom: 20px; }
        .bp-card.do .bp-title { color: var(--green); }
        .bp-card.dont .bp-title { color: var(--red); }
        .bp-list { list-style: none; margin: 0; padding: 0; }
        .bp-list li { font-size: 13px; color: var(--text-secondary); padding: 6px 0; display: flex; align-items: flex-start; gap: 10px; }
        .bp-list li .icon { flex-shrink: 0; }
        .bp-card.do .bp-list li .icon { color: var(--green); }
        .bp-card.dont .bp-list li .icon { color: var(--red); }

        /* Agent Section */
        .agent-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; margin-bottom: 24px; }
        .agent-info { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; }
        .agent-avatar { width: 56px; height: 56px; background: linear-gradient(135deg, #8B5CF6, #EC4899); border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 28px; margin-bottom: 16px; }
        .agent-name { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .agent-role { font-size: 12px; color: var(--page-light); margin-bottom: 16px; }
        .agent-desc { font-size: 12px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; }
        .agent-caps { list-style: none; margin: 0; padding: 0; }
        .agent-caps li { font-size: 12px; color: var(--text-secondary); padding: 8px 0; display: flex; align-items: center; gap: 10px; }
        .agent-caps li .icon { color: var(--page-light); }

        .code-panel { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; overflow: hidden; }
        .code-header { background: var(--bg-card-alt); padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
        .code-tab { font-size: 12px; font-weight: 600; color: var(--page-light); }
        .code-filename { font-size: 11px; color: var(--text-muted); }
        .code-content { padding: 20px; font-family: 'Monaco', 'Menlo', monospace; font-size: 11px; line-height: 1.7; overflow-x: auto; }
        .code-content pre { color: var(--text-secondary); }
        .code-keyword { color: #FF7B72; }
        .code-string { color: #A5D6FF; }
        .code-comment { color: #6A737D; }

        /* Related Grid */
        .related-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; }
        .related-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 18px; text-decoration: none; transition: all 0.2s; }
        .related-card:hover { border-color: var(--page-color); transform: translateY(-2px); }
        .related-num { font-size: 10px; color: var(--page-light); margin-bottom: 6px; }
        .related-title { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }
        .related-desc { font-size: 11px; color: var(--text-muted); }

        /* Footer */
        footer { background: var(--bg-card); border-top: 1px solid var(--border-color); padding: 24px 32px; margin-left: var(--sidebar-width); }
        .footer-nav { display: flex; justify-content: space-between; align-items: center; }
        .footer-link { display: flex; align-items: center; gap: 12px; text-decoration: none; color: var(--text-secondary); padding: 12px 20px; background: var(--bg-card-alt); border: 1px solid var(--border-color); border-radius: 12px; transition: all 0.2s; }
        .footer-link:hover { border-color: var(--page-color); color: var(--text-primary); }
        .footer-link-label { font-size: 11px; color: var(--text-muted); }
        .footer-link-title { font-size: 13px; font-weight: 600; }
        .footer-brand { font-size: 13px; color: var(--text-muted); }
        .footer-brand span { color: var(--brand-orange); }

        /* Deep Dive Architecture Cards */
        .arch-deep-dive { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 14px; margin-bottom: 24px; overflow: hidden; }
        .deep-header { display: flex; align-items: center; gap: 16px; padding: 20px 24px; }
        .deep-header.cqrs { background: linear-gradient(90deg, rgba(139, 92, 246, 0.15), transparent); border-bottom: 3px solid #8B5CF6; }
        .deep-header.es { background: linear-gradient(90deg, rgba(236, 72, 153, 0.15), transparent); border-bottom: 3px solid #EC4899; }
        .deep-header.combined { background: linear-gradient(90deg, rgba(6, 182, 212, 0.15), transparent); border-bottom: 3px solid #06B6D4; }
        .deep-icon { font-size: 32px; }
        .deep-title h3 { font-size: 18px; font-weight: 600; margin-bottom: 4px; }
        .deep-header.cqrs .deep-title h3 { color: #A78BFA; }
        .deep-header.es .deep-title h3 { color: #F472B6; }
        .deep-header.combined .deep-title h3 { color: #22D3EE; }
        .deep-era { font-size: 11px; color: var(--text-muted); background: var(--bg-dark); padding: 2px 8px; border-radius: 4px; }
        .deep-content { padding: 24px; }
        .deep-definition { background: var(--bg-dark); border-radius: 8px; padding: 16px; margin-bottom: 20px; }
        .deep-definition p { font-size: 13px; color: var(--text-secondary); line-height: 1.7; margin: 0; }
        .deep-definition p strong { color: var(--text-primary); }
        .deep-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .deep-box { background: var(--bg-dark); border-radius: 8px; padding: 16px; }
        .deep-box h4 { font-size: 13px; font-weight: 600; color: var(--page-light); margin-bottom: 12px; }
        .deep-box ul { list-style: none; margin: 0; padding: 0; }
        .deep-box li { font-size: 12px; color: var(--text-secondary); padding: 6px 0; border-bottom: 1px solid var(--border-color); line-height: 1.5; }
        .deep-box li:last-child { border-bottom: none; }
        .deep-box li strong { color: var(--text-primary); }
        .deep-tradeoffs { display: flex; flex-direction: column; gap: 8px; }
        .tradeoff { display: flex; align-items: flex-start; gap: 10px; font-size: 12px; padding: 10px; border-radius: 6px; }
        .tradeoff.pro { background: rgba(16, 185, 129, 0.1); color: var(--green); }
        .tradeoff.con { background: rgba(239, 68, 68, 0.1); color: var(--red); }
        .tradeoff-icon { font-weight: 700; flex-shrink: 0; }

        /* Combined Flow */
        .combined-flow { display: flex; align-items: center; justify-content: center; gap: 8px; flex-wrap: wrap; padding: 16px; background: var(--bg-dark); border-radius: 8px; }
        .combined-step { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; }
        .combined-num { width: 24px; height: 24px; background: var(--page-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; flex-shrink: 0; }
        .combined-text { font-size: 11px; color: var(--text-secondary); }
        .combined-text strong { color: var(--text-primary); }
        .combined-arrow { color: var(--page-light); font-size: 16px; }

        /* Decision Grid */
        .decision-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 24px; }
        .decision-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; }
        .decision-card.crud-dec { border-top: 4px solid #6a6a7a; }
        .decision-card.cqrs-dec { border-top: 4px solid #8B5CF6; }
        .decision-card.es-dec { border-top: 4px solid #EC4899; }
        .decision-card.both-dec { border-top: 4px solid #06B6D4; }
        .decision-header { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
        .decision-icon { font-size: 24px; }
        .decision-header h4 { font-size: 14px; font-weight: 600; color: var(--text-primary); margin: 0; }
        .decision-list { list-style: none; margin: 0 0 16px 0; padding: 0; }
        .decision-list li { font-size: 12px; color: var(--text-secondary); padding: 6px 0; line-height: 1.5; }
        .decision-example { background: var(--bg-dark); border-radius: 6px; padding: 12px; font-size: 11px; color: var(--text-muted); line-height: 1.5; }
        .decision-example strong { color: var(--text-secondary); }

        /* Decision Flowchart */
        .decision-flowchart { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; }
        .decision-flowchart h4 { font-size: 14px; font-weight: 600; color: var(--page-light); margin-bottom: 16px; text-align: center; }
        .flowchart-content { text-align: center; }
        .flow-question { font-size: 14px; color: var(--text-primary); font-weight: 600; margin-bottom: 20px; padding: 16px; background: var(--bg-dark); border-radius: 8px; }
        .flow-branches { display: flex; justify-content: center; gap: 16px; flex-wrap: wrap; }
        .flow-branch { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        .flow-answer { font-size: 10px; padding: 6px 12px; border-radius: 4px; background: rgba(107, 114, 128, 0.2); color: var(--text-secondary); }
        .flow-answer.yes { background: rgba(16, 185, 129, 0.2); color: var(--green); }
        .flow-answer.no { background: rgba(107, 114, 128, 0.2); color: var(--text-secondary); }
        .flow-result { font-size: 11px; font-weight: 600; padding: 8px 16px; border-radius: 6px; }
        .flow-result.es-r { background: rgba(236, 72, 153, 0.2); color: #EC4899; }
        .flow-result.cqrs-r { background: rgba(139, 92, 246, 0.2); color: #8B5CF6; }
        .flow-result.crud-r { background: rgba(107, 114, 128, 0.2); color: #6a6a7a; }

        /* Evolution Timeline */
        .evolution-timeline { background: var(--bg-dark); border: 1px solid var(--border-color); border-radius: 12px; padding: 24px; margin-bottom: 24px; }
        .evolution-svg { width: 100%; height: auto; }
        .evolution-details { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .evo-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 16px; position: relative; }
        .evo-num { position: absolute; top: -10px; left: 16px; width: 24px; height: 24px; background: var(--page-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; }
        .evo-card h4 { font-size: 13px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; margin-top: 8px; }
        .evo-card p { font-size: 11px; color: var(--text-secondary); line-height: 1.6; margin: 0; }
        .evo-card p strong { color: var(--page-light); }

        @media (max-width: 1024px) {
            .sidebar { display: none; }
            .main-wrapper { margin-left: 0; }
            footer { margin-left: 0; }
            .hero-stats, .business-grid, .use-cases-grid { grid-template-columns: repeat(2, 1fr); }
            .two-col, .bp-grid, .agent-grid, .pattern-grid, .decision-grid { grid-template-columns: 1fr; }
            .related-grid { grid-template-columns: 1fr; }
            .compare-header, .compare-row { grid-template-columns: 1fr; gap: 8px; }
            .compare-col { text-align: left; padding: 4px 0; }
            .flow-explanation { grid-template-columns: 1fr; }
            .deep-grid { grid-template-columns: 1fr; }
            .evolution-details { grid-template-columns: repeat(2, 1fr); }
            .combined-flow { flex-direction: column; }
            .combined-arrow { transform: rotate(90deg); }
        }
    </style>
</head>
<body>

<header>
    <a href="index.html" class="logo"><span>STRATEGY</span>HUB</a>
    <div class="header-tagline">Enterprise Technology Knowledge Base</div>
</header>

<aside class="sidebar">
    <div class="sidebar-section">
        <div class="sidebar-title">üèóÔ∏è Category 09</div>
        <ul class="sidebar-nav">
            <li><a href="cat09-architecture-overview.html"><span class="nav-icon">üè†</span> Overview</a></li>
            <li><a href="cat09-p1-microservices.html"><span class="nav-icon">üî≤</span> 9.1 Microservices</a></li>
            <li><a href="cat09-p2-event-driven.html"><span class="nav-icon">‚ö°</span> 9.2 Event-Driven</a></li>
            <li><a href="cat09-p3-data-mesh.html"><span class="nav-icon">üï∏Ô∏è</span> 9.3 Data Mesh</a></li>
            <li><a href="cat09-p4-lakehouse.html"><span class="nav-icon">üè†</span> 9.4 Lakehouse</a></li>
            <li><a href="cat09-p5-api-patterns.html"><span class="nav-icon">üîå</span> 9.5 API Patterns</a></li>
            <li><a href="cat09-p6-cqrs-eventsourcing.html" class="active"><span class="nav-icon">üìù</span> 9.6 CQRS & Event Sourcing</a></li>
            <li><a href="cat09-p7-domain-driven.html"><span class="nav-icon">üéØ</span> 9.7 Domain-Driven Design</a></li>
        </ul>
    </div>
    <div class="sidebar-section">
        <div class="sidebar-title">üìë On This Page</div>
        <ul class="sidebar-nav">
            <li><a href="#overview"><span class="nav-icon">üìñ</span> Overview</a></li>
            <li><a href="#business-case"><span class="nav-icon">üíº</span> Business Case</a></li>
            <li><a href="#architecture"><span class="nav-icon">üèóÔ∏è</span> Architecture</a></li>
            <li><a href="#patterns"><span class="nav-icon">üîÑ</span> The Patterns</a></li>
            <li><a href="#comparison"><span class="nav-icon">‚öñÔ∏è</span> Comparison</a></li>
            <li><a href="#deep-dive"><span class="nav-icon">üîç</span> Deep Dive</a></li>
            <li><a href="#decision"><span class="nav-icon">üéØ</span> When to Use</a></li>
            <li><a href="#evolution"><span class="nav-icon">üìà</span> Evolution</a></li>
            <li><a href="#use-cases"><span class="nav-icon">üí°</span> Use Cases</a></li>
            <li><a href="#practices"><span class="nav-icon">‚úÖ</span> Best Practices</a></li>
            <li><a href="#agent"><span class="nav-icon">ü§ñ</span> Agent This</a></li>
        </ul>
    </div>
</aside>

<div class="main-wrapper">
    <div class="main-content">

        <!-- HERO -->
        <section class="hero" id="overview">
            <div class="hero-tag">üìö Page 9.6 ‚Ä¢ Advanced Data Patterns</div>
            <h1>CQRS & Event Sourcing</h1>
            <p>Command Query Responsibility Segregation (CQRS) separates reads from writes for independent scaling. Event Sourcing stores all changes as immutable events, providing complete audit trails and the ability to reconstruct state at any point in time. Together, they enable powerful temporal queries and complex domain modeling.</p>
            <div class="hero-stats">
                <div class="hero-stat"><div class="hero-stat-value">‚àû</div><div class="hero-stat-label">Audit History</div></div>
                <div class="hero-stat"><div class="hero-stat-value">10x</div><div class="hero-stat-label">Read Scaling</div></div>
                <div class="hero-stat"><div class="hero-stat-value">100%</div><div class="hero-stat-label">State Rebuild</div></div>
                <div class="hero-stat"><div class="hero-stat-value">Time</div><div class="hero-stat-label">Travel Queries</div></div>
            </div>
        </section>

        <!-- BUSINESS CASE -->
        <section class="module" id="business-case">
            <div class="module-header">
                <div class="module-icon">üíº</div>
                <div class="module-info">
                    <h2>The Business Case</h2>
                    <p>Why CQRS and Event Sourcing matter for enterprises</p>
                </div>
            </div>

            <div class="business-grid">
                <div class="business-card">
                    <div class="business-icon">üìã</div>
                    <div class="business-stat">100%</div>
                    <div class="business-label">Complete Audit Trail</div>
                    <div class="business-desc">Every change is recorded‚Äîregulatory compliance built-in</div>
                </div>
                <div class="business-card">
                    <div class="business-icon">‚è™</div>
                    <div class="business-stat">Any</div>
                    <div class="business-label">Point-in-Time Rebuild</div>
                    <div class="business-desc">Reconstruct exact state at any moment in history</div>
                </div>
                <div class="business-card">
                    <div class="business-icon">üìä</div>
                    <div class="business-stat">10x</div>
                    <div class="business-label">Read Performance</div>
                    <div class="business-desc">Optimized read models scale independently from writes</div>
                </div>
                <div class="business-card">
                    <div class="business-icon">üîÑ</div>
                    <div class="business-stat">New</div>
                    <div class="business-label">Retroactive Features</div>
                    <div class="business-desc">Replay events to build new projections from old data</div>
                </div>
            </div>
        </section>

        <!-- ARCHITECTURE DIAGRAM -->
        <section class="module" id="architecture">
            <div class="module-header">
                <div class="module-icon">üèóÔ∏è</div>
                <div class="module-info">
                    <h2>CQRS + Event Sourcing Architecture</h2>
                    <p>How commands, events, and queries flow</p>
                </div>
            </div>

            <div class="architecture-diagram">
                <svg viewBox="0 0 900 400" class="arch-svg">
                    <defs>
                        <pattern id="cqrsGrid" width="20" height="20" patternUnits="userSpaceOnUse">
                            <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#1a1a2e" stroke-width="0.5"/>
                        </pattern>
                        <marker id="cqrsArrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                            <polygon points="0 0, 10 3.5, 0 7" fill="#818CF8"/>
                        </marker>
                    </defs>
                    
                    <rect width="100%" height="100%" fill="url(#cqrsGrid)"/>
                    
                    <text x="450" y="25" text-anchor="middle" fill="#A78BFA" font-size="14" font-weight="600">CQRS + Event Sourcing Architecture</text>
                    
                    <!-- Client -->
                    <rect x="30" y="130" width="100" height="140" rx="12" fill="rgba(139, 92, 246, 0.1)" stroke="#8B5CF6" stroke-width="2"/>
                    <text x="80" y="160" text-anchor="middle" fill="#8B5CF6" font-size="11" font-weight="600">üë§ Client</text>
                    <rect x="45" y="175" width="70" height="28" rx="6" fill="#1a1a2e" stroke="#8B5CF6" stroke-width="1"/>
                    <text x="80" y="193" text-anchor="middle" fill="#A78BFA" font-size="9">Commands</text>
                    <rect x="45" y="210" width="70" height="28" rx="6" fill="#1a1a2e" stroke="#06B6D4" stroke-width="1"/>
                    <text x="80" y="228" text-anchor="middle" fill="#22D3EE" font-size="9">Queries</text>
                    
                    <!-- Command Side -->
                    <rect x="160" y="60" width="280" height="140" rx="14" fill="rgba(139, 92, 246, 0.08)" stroke="#8B5CF6" stroke-width="2"/>
                    <text x="300" y="85" text-anchor="middle" fill="#8B5CF6" font-size="11" font-weight="600">‚úèÔ∏è Command Side (Write)</text>
                    
                    <rect x="180" y="100" width="100" height="40" rx="8" fill="#1a1a2e" stroke="#8B5CF6" stroke-width="1"/>
                    <text x="230" y="118" text-anchor="middle" fill="#A78BFA" font-size="10">Command</text>
                    <text x="230" y="132" text-anchor="middle" fill="#6a6a7a" font-size="8">Handler</text>
                    
                    <rect x="180" y="150" width="100" height="40" rx="8" fill="#1a1a2e" stroke="#8B5CF6" stroke-width="1"/>
                    <text x="230" y="168" text-anchor="middle" fill="#A78BFA" font-size="10">Aggregate</text>
                    <text x="230" y="182" text-anchor="middle" fill="#6a6a7a" font-size="8">Domain Logic</text>
                    
                    <rect x="320" y="100" width="100" height="90" rx="8" fill="rgba(236, 72, 153, 0.15)" stroke="#EC4899" stroke-width="2"/>
                    <text x="370" y="125" text-anchor="middle" fill="#EC4899" font-size="10" font-weight="600">üìù Event</text>
                    <text x="370" y="140" text-anchor="middle" fill="#EC4899" font-size="10" font-weight="600">Store</text>
                    <text x="370" y="160" text-anchor="middle" fill="#6a6a7a" font-size="8">Append-Only</text>
                    <text x="370" y="175" text-anchor="middle" fill="#6a6a7a" font-size="8">Immutable Log</text>
                    
                    <!-- Event Bus -->
                    <rect x="470" y="130" width="120" height="50" rx="10" fill="rgba(245, 158, 11, 0.15)" stroke="#F59E0B" stroke-width="2"/>
                    <text x="530" y="152" text-anchor="middle" fill="#F59E0B" font-size="10" font-weight="600">üì£ Event Bus</text>
                    <text x="530" y="168" text-anchor="middle" fill="#6a6a7a" font-size="8">Kafka / EventBridge</text>
                    
                    <!-- Query Side -->
                    <rect x="160" y="220" width="280" height="140" rx="14" fill="rgba(6, 182, 212, 0.08)" stroke="#06B6D4" stroke-width="2"/>
                    <text x="300" y="245" text-anchor="middle" fill="#06B6D4" font-size="11" font-weight="600">üìñ Query Side (Read)</text>
                    
                    <rect x="180" y="260" width="100" height="40" rx="8" fill="#1a1a2e" stroke="#06B6D4" stroke-width="1"/>
                    <text x="230" y="278" text-anchor="middle" fill="#22D3EE" font-size="10">Query</text>
                    <text x="230" y="292" text-anchor="middle" fill="#6a6a7a" font-size="8">Handler</text>
                    
                    <rect x="180" y="310" width="100" height="40" rx="8" fill="#1a1a2e" stroke="#06B6D4" stroke-width="1"/>
                    <text x="230" y="328" text-anchor="middle" fill="#22D3EE" font-size="10">Read Model</text>
                    <text x="230" y="342" text-anchor="middle" fill="#6a6a7a" font-size="8">Optimized View</text>
                    
                    <rect x="320" y="260" width="100" height="90" rx="8" fill="rgba(6, 182, 212, 0.15)" stroke="#06B6D4" stroke-width="2"/>
                    <text x="370" y="285" text-anchor="middle" fill="#06B6D4" font-size="10" font-weight="600">üíæ Read</text>
                    <text x="370" y="300" text-anchor="middle" fill="#06B6D4" font-size="10" font-weight="600">Database</text>
                    <text x="370" y="320" text-anchor="middle" fill="#6a6a7a" font-size="8">Postgres / Mongo</text>
                    <text x="370" y="335" text-anchor="middle" fill="#6a6a7a" font-size="8">ElasticSearch</text>
                    
                    <!-- Projector -->
                    <rect x="620" y="220" width="120" height="70" rx="10" fill="rgba(16, 185, 129, 0.15)" stroke="#10B981" stroke-width="2"/>
                    <text x="680" y="250" text-anchor="middle" fill="#10B981" font-size="10" font-weight="600">üîÑ Projector</text>
                    <text x="680" y="268" text-anchor="middle" fill="#6a6a7a" font-size="8">Events ‚Üí Read</text>
                    <text x="680" y="280" text-anchor="middle" fill="#6a6a7a" font-size="8">Model Updates</text>
                    
                    <!-- Arrows -->
                    <path d="M 135 190 L 175 120" stroke="#8B5CF6" stroke-width="2" marker-end="url(#cqrsArrow)" fill="none"/>
                    <path d="M 135 225 L 175 280" stroke="#06B6D4" stroke-width="2" marker-end="url(#cqrsArrow)" fill="none"/>
                    <path d="M 285 140 L 315 140" stroke="#818CF8" stroke-width="2" marker-end="url(#cqrsArrow)" fill="none"/>
                    <path d="M 425 155 L 465 155" stroke="#F59E0B" stroke-width="2" marker-end="url(#cqrsArrow)" fill="none"/>
                    <path d="M 595 155 L 680 155 L 680 215" stroke="#10B981" stroke-width="2" marker-end="url(#cqrsArrow)" fill="none"/>
                    <path d="M 620 270 L 425 305" stroke="#10B981" stroke-width="2" marker-end="url(#cqrsArrow)" fill="none"/>
                    
                    <!-- Legend -->
                    <rect x="620" y="320" width="250" height="60" rx="8" fill="#1a1a2e" stroke="#2a2a3e"/>
                    <text x="640" y="342" fill="#6a6a7a" font-size="9">Flow:</text>
                    <text x="640" y="360" fill="#8B5CF6" font-size="8">1. Commands ‚Üí Aggregates ‚Üí Events</text>
                    <text x="640" y="375" fill="#06B6D4" font-size="8">2. Events ‚Üí Projectors ‚Üí Read Models</text>
                </svg>
            </div>
            
            <div class="flow-explanation">
                <div class="flow-step">
                    <span class="step-num">1</span>
                    <span class="step-text"><strong>Command received</strong> ‚Äî Client sends intent to change state (PlaceOrder, UpdateProfile)</span>
                </div>
                <div class="flow-step">
                    <span class="step-num">2</span>
                    <span class="step-text"><strong>Aggregate processes</strong> ‚Äî Domain logic validates and produces events (OrderPlaced, ProfileUpdated)</span>
                </div>
                <div class="flow-step">
                    <span class="step-num">3</span>
                    <span class="step-text"><strong>Events stored</strong> ‚Äî Immutable events appended to event store (source of truth)</span>
                </div>
                <div class="flow-step">
                    <span class="step-num">4</span>
                    <span class="step-text"><strong>Events published</strong> ‚Äî Event bus notifies all interested projectors</span>
                </div>
                <div class="flow-step">
                    <span class="step-num">5</span>
                    <span class="step-text"><strong>Projectors update</strong> ‚Äî Read models updated for optimized query patterns</span>
                </div>
                <div class="flow-step">
                    <span class="step-num">6</span>
                    <span class="step-text"><strong>Queries served</strong> ‚Äî Clients query denormalized, fast read models directly</span>
                </div>
            </div>
        </section>

        <!-- THE PATTERNS -->
        <section class="module" id="patterns">
            <div class="module-header">
                <div class="module-icon">üîÑ</div>
                <div class="module-info">
                    <h2>Understanding the Patterns</h2>
                    <p>CQRS and Event Sourcing explained</p>
                </div>
            </div>

            <div class="pattern-grid">
                <div class="pattern-card cqrs">
                    <div class="pattern-header">
                        <div class="pattern-icon">‚úèÔ∏èüìñ</div>
                        <div class="pattern-title">
                            <h3>CQRS</h3>
                            <div class="tagline">Command Query Responsibility Segregation</div>
                        </div>
                    </div>
                    <div class="pattern-desc">Separate models for reading and writing data. Commands mutate state through one model, queries read through another. Each can be optimized independently‚Äîwrites for consistency, reads for performance.</div>
                    <div class="code-block">
                        <span class="comment">// Command Model (Write)</span><br>
                        <span class="keyword">class</span> <span class="class">PlaceOrderCommand</span> {<br>
                        &nbsp;&nbsp;customerId: string;<br>
                        &nbsp;&nbsp;items: OrderItem[];<br>
                        }<br><br>
                        <span class="comment">// Query Model (Read)</span><br>
                        <span class="keyword">class</span> <span class="class">OrderSummaryQuery</span> {<br>
                        &nbsp;&nbsp;orderId: string;<br>
                        &nbsp;&nbsp;status: string;<br>
                        &nbsp;&nbsp;total: number;<br>
                        }
                    </div>
                    <div class="pattern-features">
                        <span class="pattern-feature">Independent Scaling</span>
                        <span class="pattern-feature">Optimized Models</span>
                        <span class="pattern-feature">Clear Intent</span>
                        <span class="pattern-feature">Different DBs</span>
                    </div>
                </div>

                <div class="pattern-card es">
                    <div class="pattern-header">
                        <div class="pattern-icon">üìú</div>
                        <div class="pattern-title">
                            <h3>Event Sourcing</h3>
                            <div class="tagline">State as a sequence of events</div>
                        </div>
                    </div>
                    <div class="pattern-desc">Instead of storing current state, store all events that led to the current state. Current state is derived by replaying events. Provides complete audit trail and ability to rebuild state at any point in time.</div>
                    <div class="code-block">
                        <span class="comment">// Event Store (append-only)</span><br>
                        [<br>
                        &nbsp;&nbsp;{ <span class="string">type</span>: "OrderCreated", <span class="string">orderId</span>: "123", <span class="string">ts</span>: "..." },<br>
                        &nbsp;&nbsp;{ <span class="string">type</span>: "ItemAdded", <span class="string">item</span>: "SKU-1", <span class="string">qty</span>: 2 },<br>
                        &nbsp;&nbsp;{ <span class="string">type</span>: "ItemAdded", <span class="string">item</span>: "SKU-2", <span class="string">qty</span>: 1 },<br>
                        &nbsp;&nbsp;{ <span class="string">type</span>: "OrderSubmitted", <span class="string">total</span>: 99.50 }<br>
                        ]
                    </div>
                    <div class="pattern-features">
                        <span class="pattern-feature">Complete History</span>
                        <span class="pattern-feature">Time Travel</span>
                        <span class="pattern-feature">Audit Trail</span>
                        <span class="pattern-feature">Replay Events</span>
                    </div>
                </div>
            </div>

            <div class="content-block">
                <h3>When to Use Together</h3>
                <p>CQRS and Event Sourcing are often used together but are <strong>independent patterns</strong>. You can use CQRS without Event Sourcing (different read/write DBs) or Event Sourcing without CQRS (single model, events as storage).</p>
                <p><strong>Together they shine when:</strong> You need complete audit trails, temporal queries ("what was the state on Jan 1?"), complex domains with many integrations, or high read/write ratio imbalance.</p>
            </div>
        </section>

        <!-- COMPARISON -->
        <section class="module" id="comparison">
            <div class="module-header">
                <div class="module-icon">‚öñÔ∏è</div>
                <div class="module-info">
                    <h2>Pattern Comparison</h2>
                    <p>Traditional CRUD vs CQRS vs CQRS+ES</p>
                </div>
            </div>

            <div class="compare-table">
                <div class="compare-header">
                    <div class="compare-col">Capability</div>
                    <div class="compare-col traditional">üóÑÔ∏è Traditional CRUD</div>
                    <div class="compare-col cqrs">‚úèÔ∏è CQRS Only</div>
                    <div class="compare-col cqrs-es">üìú CQRS + ES</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">Audit Trail</div>
                    <div class="compare-cell cell-bad">Manual/Triggers</div>
                    <div class="compare-cell cell-mid">Manual</div>
                    <div class="compare-cell cell-good">Built-in</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">Time Travel Queries</div>
                    <div class="compare-cell cell-bad">Not possible</div>
                    <div class="compare-cell cell-bad">Not possible</div>
                    <div class="compare-cell cell-good">Native</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">Read Scaling</div>
                    <div class="compare-cell cell-mid">Replicas</div>
                    <div class="compare-cell cell-good">Independent</div>
                    <div class="compare-cell cell-good">Independent</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">Complexity</div>
                    <div class="compare-cell cell-good">Low</div>
                    <div class="compare-cell cell-mid">Medium</div>
                    <div class="compare-cell cell-bad">High</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">Debugging</div>
                    <div class="compare-cell cell-mid">Current state</div>
                    <div class="compare-cell cell-mid">Current state</div>
                    <div class="compare-cell cell-good">Full replay</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">Eventual Consistency</div>
                    <div class="compare-cell cell-good">None (strong)</div>
                    <div class="compare-cell cell-mid">Possible</div>
                    <div class="compare-cell cell-bad">Inherent</div>
                </div>
                <div class="compare-row">
                    <div class="compare-col">New Projections</div>
                    <div class="compare-cell cell-bad">Requires migration</div>
                    <div class="compare-cell cell-mid">New query model</div>
                    <div class="compare-cell cell-good">Replay events</div>
                </div>
            </div>
        </section>

        <!-- UNDERSTANDING CQRS & ES -->
        <section class="module" id="deep-dive">
            <div class="module-header">
                <div class="module-icon">üîç</div>
                <div class="module-info">
                    <h2>Understanding the Patterns</h2>
                    <p>Deep dive into CQRS and Event Sourcing</p>
                </div>
            </div>

            <!-- CQRS Deep Dive -->
            <div class="arch-deep-dive">
                <div class="deep-header cqrs">
                    <span class="deep-icon">üìñ</span>
                    <div class="deep-title">
                        <h3>CQRS (Command Query Responsibility Segregation)</h3>
                        <span class="deep-era">Introduced by Greg Young, 2010</span>
                    </div>
                </div>
                <div class="deep-content">
                    <div class="deep-definition">
                        <p><strong>What it is:</strong> A pattern that separates read and write operations into different models. Commands (writes) go to one model optimized for validation and business logic. Queries (reads) go to a separate model optimized for fast retrieval. The two models can use different databases, schemas, and even different technologies.</p>
                    </div>
                    <div class="deep-grid">
                        <div class="deep-box">
                            <h4>Command Side (Write)</h4>
                            <ul>
                                <li><strong>Commands:</strong> Intent to change state (CreateOrder, UpdateProfile)</li>
                                <li><strong>Validation:</strong> Business rules, authorization checks</li>
                                <li><strong>Domain Model:</strong> Rich objects with behavior</li>
                                <li><strong>Storage:</strong> Optimized for writes (normalized, transactional)</li>
                                <li><strong>Example DB:</strong> PostgreSQL, Event Store</li>
                            </ul>
                        </div>
                        <div class="deep-box">
                            <h4>Query Side (Read)</h4>
                            <ul>
                                <li><strong>Queries:</strong> Requests for data (GetOrderDetails, ListProducts)</li>
                                <li><strong>Read Models:</strong> Denormalized views, pre-computed</li>
                                <li><strong>Projections:</strong> Transform events ‚Üí read models</li>
                                <li><strong>Storage:</strong> Optimized for reads (denormalized, cached)</li>
                                <li><strong>Example DB:</strong> Elasticsearch, Redis, MongoDB</li>
                            </ul>
                        </div>
                    </div>
                    <div class="deep-tradeoffs">
                        <div class="tradeoff pro">
                            <span class="tradeoff-icon">‚úì</span>
                            <span>Independent scaling, optimized models, clear separation of concerns, different teams can own each side</span>
                        </div>
                        <div class="tradeoff con">
                            <span class="tradeoff-icon">‚úó</span>
                            <span>Eventual consistency, increased complexity, data synchronization overhead, more infrastructure</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Event Sourcing Deep Dive -->
            <div class="arch-deep-dive">
                <div class="deep-header es">
                    <span class="deep-icon">üìö</span>
                    <div class="deep-title">
                        <h3>Event Sourcing</h3>
                        <span class="deep-era">Pattern popularized 2005-2010</span>
                    </div>
                </div>
                <div class="deep-content">
                    <div class="deep-definition">
                        <p><strong>What it is:</strong> Instead of storing current state, you store a sequence of events that led to that state. The current state is derived by replaying events. Think of it like a bank statement‚Äîyou don't store the balance, you store every transaction and calculate the balance from them.</p>
                    </div>
                    <div class="deep-grid">
                        <div class="deep-box">
                            <h4>Key Concepts</h4>
                            <ul>
                                <li><strong>Event:</strong> Immutable fact that happened (OrderPlaced, PaymentReceived)</li>
                                <li><strong>Event Store:</strong> Append-only log of all events</li>
                                <li><strong>Aggregate:</strong> Consistency boundary that produces events</li>
                                <li><strong>Projection:</strong> Read model built from events</li>
                                <li><strong>Snapshot:</strong> Cached state to speed up replay</li>
                            </ul>
                        </div>
                        <div class="deep-box">
                            <h4>Event Anatomy</h4>
                            <ul>
                                <li><strong>Event ID:</strong> Unique identifier</li>
                                <li><strong>Aggregate ID:</strong> Which entity this belongs to</li>
                                <li><strong>Event Type:</strong> What happened (OrderCreated)</li>
                                <li><strong>Timestamp:</strong> When it happened</li>
                                <li><strong>Payload:</strong> Event-specific data</li>
                                <li><strong>Metadata:</strong> User, correlation ID, etc.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="deep-tradeoffs">
                        <div class="tradeoff pro">
                            <span class="tradeoff-icon">‚úì</span>
                            <span>Complete audit trail, time travel, rebuild any projection, debug by replaying, retroactive features</span>
                        </div>
                        <div class="tradeoff con">
                            <span class="tradeoff-icon">‚úó</span>
                            <span>Event versioning complexity, eventual consistency, storage growth, steep learning curve</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Combined Pattern -->
            <div class="arch-deep-dive">
                <div class="deep-header combined">
                    <span class="deep-icon">üîó</span>
                    <div class="deep-title">
                        <h3>CQRS + Event Sourcing (Combined)</h3>
                        <span class="deep-era">Often used together but independent</span>
                    </div>
                </div>
                <div class="deep-content">
                    <div class="deep-definition">
                        <p><strong>What it is:</strong> When combined, commands produce events that are stored in an event store (Event Sourcing), and those events are projected into read models (CQRS). This gives you the full audit trail of ES plus the read optimization of CQRS. They complement each other but can be used separately.</p>
                    </div>
                    <div class="combined-flow">
                        <div class="combined-step">
                            <span class="combined-num">1</span>
                            <span class="combined-text"><strong>Command</strong> received (PlaceOrder)</span>
                        </div>
                        <div class="combined-arrow">‚Üí</div>
                        <div class="combined-step">
                            <span class="combined-num">2</span>
                            <span class="combined-text"><strong>Aggregate</strong> validates & produces events</span>
                        </div>
                        <div class="combined-arrow">‚Üí</div>
                        <div class="combined-step">
                            <span class="combined-num">3</span>
                            <span class="combined-text"><strong>Events</strong> stored in Event Store</span>
                        </div>
                        <div class="combined-arrow">‚Üí</div>
                        <div class="combined-step">
                            <span class="combined-num">4</span>
                            <span class="combined-text"><strong>Projector</strong> updates read models</span>
                        </div>
                        <div class="combined-arrow">‚Üí</div>
                        <div class="combined-step">
                            <span class="combined-num">5</span>
                            <span class="combined-text"><strong>Query</strong> served from read model</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- DECISION FRAMEWORK -->
        <section class="module" id="decision">
            <div class="module-header">
                <div class="module-icon">üéØ</div>
                <div class="module-info">
                    <h2>When to Use Each Pattern</h2>
                    <p>Decision framework for your architecture</p>
                </div>
            </div>

            <div class="decision-grid">
                <div class="decision-card crud-dec">
                    <div class="decision-header">
                        <span class="decision-icon">üìù</span>
                        <h4>Use Traditional CRUD When...</h4>
                    </div>
                    <ul class="decision-list">
                        <li>‚úì Simple domain with basic business logic</li>
                        <li>‚úì No audit trail requirements</li>
                        <li>‚úì Strong consistency is required</li>
                        <li>‚úì Small team / MVP / prototype</li>
                        <li>‚úì Read and write patterns are similar</li>
                        <li>‚úì Low complexity is priority</li>
                    </ul>
                    <div class="decision-example">
                        <strong>Example:</strong> Blog CMS, simple inventory, internal tools‚Äîstraightforward create/read/update/delete.
                    </div>
                </div>

                <div class="decision-card cqrs-dec">
                    <div class="decision-header">
                        <span class="decision-icon">üìñ</span>
                        <h4>Use CQRS (without ES) When...</h4>
                    </div>
                    <ul class="decision-list">
                        <li>‚úì Read/write patterns are very different</li>
                        <li>‚úì Need to scale reads independently</li>
                        <li>‚úì Complex queries across aggregates</li>
                        <li>‚úì Different read models for different clients</li>
                        <li>‚úì Audit trail is nice-to-have, not required</li>
                        <li>‚úì Can tolerate some eventual consistency</li>
                    </ul>
                    <div class="decision-example">
                        <strong>Example:</strong> E-commerce catalog, social media feeds‚Äîheavy reads, occasional writes.
                    </div>
                </div>

                <div class="decision-card es-dec">
                    <div class="decision-header">
                        <span class="decision-icon">üìö</span>
                        <h4>Use Event Sourcing When...</h4>
                    </div>
                    <ul class="decision-list">
                        <li>‚úì Complete audit trail is mandatory</li>
                        <li>‚úì Regulatory/compliance requirements</li>
                        <li>‚úì Need to know "why" not just "what"</li>
                        <li>‚úì Temporal queries ("state on date X")</li>
                        <li>‚úì Domain experts think in events</li>
                        <li>‚úì May need new projections in future</li>
                    </ul>
                    <div class="decision-example">
                        <strong>Example:</strong> Banking ledger, medical records, legal documents‚Äîhistory is the product.
                    </div>
                </div>

                <div class="decision-card both-dec">
                    <div class="decision-header">
                        <span class="decision-icon">üîó</span>
                        <h4>Use CQRS + ES Together When...</h4>
                    </div>
                    <ul class="decision-list">
                        <li>‚úì All ES benefits + read optimization</li>
                        <li>‚úì Complex domain with many integrations</li>
                        <li>‚úì Multiple bounded contexts/microservices</li>
                        <li>‚úì Team has experience with patterns</li>
                        <li>‚úì Long-term system with evolving needs</li>
                        <li>‚úì Worth the complexity investment</li>
                    </ul>
                    <div class="decision-example">
                        <strong>Example:</strong> Trading platform, healthcare system, enterprise ERP‚Äîmission-critical with full history.
                    </div>
                </div>
            </div>

            <div class="decision-flowchart">
                <h4>Quick Decision Tree</h4>
                <div class="flowchart-content">
                    <div class="flow-question">Do you need a complete, immutable audit trail of all changes?</div>
                    <div class="flow-branches">
                        <div class="flow-branch">
                            <span class="flow-answer yes">Yes, mandatory</span>
                            <span class="flow-result es-r">‚Üí Event Sourcing (+ CQRS if read optimization needed)</span>
                        </div>
                        <div class="flow-branch">
                            <span class="flow-answer no">No</span>
                            <span class="flow-result">Are read/write patterns very different?</span>
                        </div>
                    </div>
                    <div class="flow-branches" style="margin-top: 12px;">
                        <div class="flow-branch">
                            <span class="flow-answer">Yes, 10:1+ reads</span>
                            <span class="flow-result cqrs-r">‚Üí CQRS</span>
                        </div>
                        <div class="flow-branch">
                            <span class="flow-answer">No, balanced</span>
                            <span class="flow-result crud-r">‚Üí Traditional CRUD</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- EVOLUTION -->
        <section class="module" id="evolution">
            <div class="module-header">
                <div class="module-icon">üìà</div>
                <div class="module-info">
                    <h2>Evolution of Data Persistence</h2>
                    <p>From CRUD to Event Sourcing</p>
                </div>
            </div>

            <div class="evolution-timeline">
                <svg viewBox="0 0 900 200" class="evolution-svg">
                    <defs>
                        <linearGradient id="esTimelineBg" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" stop-color="#6a6a7a" stop-opacity="0.1"/>
                            <stop offset="33%" stop-color="#3B82F6" stop-opacity="0.1"/>
                            <stop offset="66%" stop-color="#8B5CF6" stop-opacity="0.1"/>
                            <stop offset="100%" stop-color="#EC4899" stop-opacity="0.1"/>
                        </linearGradient>
                    </defs>
                    
                    <!-- Background -->
                    <rect x="0" y="70" width="900" height="60" fill="url(#esTimelineBg)" rx="8"/>
                    
                    <!-- Timeline line -->
                    <line x1="60" y1="100" x2="840" y2="100" stroke="#2a2a3e" stroke-width="3"/>
                    
                    <!-- Era 1: CRUD -->
                    <circle cx="140" cy="100" r="32" fill="#12121a" stroke="#6a6a7a" stroke-width="3"/>
                    <text x="140" y="108" text-anchor="middle" font-size="24">üìù</text>
                    <text x="140" y="150" text-anchor="middle" fill="#6a6a7a" font-size="12" font-weight="600">CRUD</text>
                    <text x="140" y="167" text-anchor="middle" fill="#4a4a5a" font-size="9">1970s-Present</text>
                    
                    <!-- Connector -->
                    <line x1="175" y1="100" x2="265" y2="100" stroke="#6a6a7a" stroke-width="2"/>
                    <text x="220" y="60" text-anchor="middle" fill="#EF4444" font-size="8">No history</text>
                    
                    <!-- Era 2: Audit Tables -->
                    <circle cx="340" cy="100" r="32" fill="#12121a" stroke="#3B82F6" stroke-width="3"/>
                    <text x="340" y="108" text-anchor="middle" font-size="24">üìã</text>
                    <text x="340" y="150" text-anchor="middle" fill="#3B82F6" font-size="12" font-weight="600">Audit Tables</text>
                    <text x="340" y="167" text-anchor="middle" fill="#6a6a7a" font-size="9">1990s-Present</text>
                    
                    <!-- Connector -->
                    <line x1="375" y1="100" x2="465" y2="100" stroke="#3B82F6" stroke-width="2"/>
                    <text x="420" y="60" text-anchor="middle" fill="#EF4444" font-size="8">Afterthought</text>
                    
                    <!-- Era 3: CQRS -->
                    <circle cx="540" cy="100" r="32" fill="#12121a" stroke="#8B5CF6" stroke-width="3"/>
                    <text x="540" y="108" text-anchor="middle" font-size="24">üìñ</text>
                    <text x="540" y="150" text-anchor="middle" fill="#8B5CF6" font-size="12" font-weight="600">CQRS</text>
                    <text x="540" y="167" text-anchor="middle" fill="#6a6a7a" font-size="9">2010-Present</text>
                    
                    <!-- Connector -->
                    <line x1="575" y1="100" x2="665" y2="100" stroke="#8B5CF6" stroke-width="2"/>
                    
                    <!-- Era 4: Event Sourcing -->
                    <circle cx="740" cy="100" r="36" fill="#12121a" stroke="#EC4899" stroke-width="4"/>
                    <text x="740" y="108" text-anchor="middle" font-size="28">üìö</text>
                    <text x="740" y="150" text-anchor="middle" fill="#EC4899" font-size="13" font-weight="700">Event Sourcing</text>
                    <text x="740" y="167" text-anchor="middle" fill="#6a6a7a" font-size="9">2010s-Present</text>
                    
                    <!-- Badge -->
                    <rect x="695" y="175" width="90" height="18" rx="9" fill="rgba(16, 185, 129, 0.2)" stroke="#10B981" stroke-width="1"/>
                    <text x="740" y="188" text-anchor="middle" fill="#10B981" font-size="9">‚úì History = Data</text>
                </svg>
            </div>

            <div class="evolution-details">
                <div class="evo-card">
                    <div class="evo-num">1</div>
                    <h4>CRUD Era</h4>
                    <p>Store current state only. Update in place. <strong>History lost</strong>‚Äî"what was the price last week?" requires manual logging.</p>
                </div>
                <div class="evo-card">
                    <div class="evo-num">2</div>
                    <h4>Audit Tables</h4>
                    <p>Add trigger-based audit logs. Better, but history is an <strong>afterthought</strong>‚Äîseparate from main data, often incomplete.</p>
                </div>
                <div class="evo-card">
                    <div class="evo-num">3</div>
                    <h4>CQRS</h4>
                    <p>Separate read/write models. <strong>Optimize each side</strong> independently. Still storing current state, but more flexible.</p>
                </div>
                <div class="evo-card">
                    <div class="evo-num">4</div>
                    <h4>Event Sourcing</h4>
                    <p>History IS the data. <strong>Events are first-class</strong>. Rebuild any state from events. Time travel built-in.</p>
                </div>
            </div>
        </section>

        <!-- USE CASES -->
        <section class="module" id="use-cases">
            <div class="module-header">
                <div class="module-icon">üéØ</div>
                <div class="module-info">
                    <h2>Ideal Use Cases</h2>
                    <p>Where CQRS and Event Sourcing excel</p>
                </div>
            </div>

            <div class="use-cases-grid">
                <div class="use-case-card">
                    <div class="use-case-icon">üè¶</div>
                    <div class="use-case-name">Financial Systems</div>
                    <div class="use-case-desc">Banking, trading, payments‚Äîevery transaction needs audit trail</div>
                </div>
                <div class="use-case-card">
                    <div class="use-case-icon">üè•</div>
                    <div class="use-case-name">Healthcare</div>
                    <div class="use-case-desc">Patient records require complete history and compliance</div>
                </div>
                <div class="use-case-card">
                    <div class="use-case-icon">üõí</div>
                    <div class="use-case-name">E-Commerce</div>
                    <div class="use-case-desc">Order lifecycle, inventory changes, pricing history</div>
                </div>
                <div class="use-case-card">
                    <div class="use-case-icon">üìä</div>
                    <div class="use-case-name">Analytics</div>
                    <div class="use-case-desc">Retroactive analysis, new metrics from old data</div>
                </div>
            </div>

            <div class="two-col">
                <div class="info-box">
                    <h4>Good Fit</h4>
                    <ul class="info-list">
                        <li><strong>Regulatory compliance:</strong> SOX, HIPAA, GDPR requiring audit trails</li>
                        <li><strong>Complex domains:</strong> Many business rules and state transitions</li>
                        <li><strong>High read/write ratio:</strong> Many readers, few writers</li>
                        <li><strong>Event-driven integrations:</strong> Many downstream consumers</li>
                        <li><strong>Temporal queries:</strong> "What was state on date X?"</li>
                    </ul>
                </div>
                <div class="info-box">
                    <h4>Poor Fit</h4>
                    <ul class="info-list">
                        <li><strong>Simple CRUD:</strong> Basic forms, no complex business logic</li>
                        <li><strong>Strong consistency required:</strong> Immediate read-your-writes</li>
                        <li><strong>Small teams:</strong> Added complexity not worth it</li>
                        <li><strong>Greenfield MVPs:</strong> Start simple, add later if needed</li>
                        <li><strong>Frequent deletes:</strong> GDPR "right to forget" is complex</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- BEST PRACTICES -->
        <section class="module" id="practices">
            <div class="module-header">
                <div class="module-icon">‚úÖ</div>
                <div class="module-info">
                    <h2>Best Practices</h2>
                    <p>Guidelines for successful implementation</p>
                </div>
            </div>

            <div class="bp-grid">
                <div class="bp-card do">
                    <div class="bp-title">‚úì Do</div>
                    <ul class="bp-list">
                        <li><span class="icon">‚úì</span> Design events as immutable facts that happened</li>
                        <li><span class="icon">‚úì</span> Version your events for schema evolution</li>
                        <li><span class="icon">‚úì</span> Use event store snapshots for long-running aggregates</li>
                        <li><span class="icon">‚úì</span> Keep aggregates small and focused</li>
                        <li><span class="icon">‚úì</span> Build multiple read models for different query patterns</li>
                        <li><span class="icon">‚úì</span> Test by replaying known event sequences</li>
                        <li><span class="icon">‚úì</span> Monitor projection lag (read model staleness)</li>
                        <li><span class="icon">‚úì</span> Design for idempotent event handlers</li>
                    </ul>
                </div>
                <div class="bp-card dont">
                    <div class="bp-title">‚úó Don't</div>
                    <ul class="bp-list">
                        <li><span class="icon">‚úó</span> Store derived data in events (calculate it)</li>
                        <li><span class="icon">‚úó</span> Mutate or delete events (ever!)</li>
                        <li><span class="icon">‚úó</span> Query the event store directly for reads</li>
                        <li><span class="icon">‚úó</span> Create "UpdatedEverything" events (be specific)</li>
                        <li><span class="icon">‚úó</span> Forget about event ordering guarantees</li>
                        <li><span class="icon">‚úó</span> Skip the "what if we need to delete data" discussion</li>
                        <li><span class="icon">‚úó</span> Use ES for the entire system (bounded contexts)</li>
                        <li><span class="icon">‚úó</span> Assume eventual consistency is always fine for UX</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- AGENT SECTION -->
        <section class="module" id="agent">
            <div class="module-header">
                <div class="module-icon">ü§ñ</div>
                <div class="module-info">
                    <h2>Agent This</h2>
                    <p>AI-powered event modeling and analysis</p>
                </div>
            </div>

            <div class="agent-grid">
                <div class="agent-info">
                    <div class="agent-avatar">üìú</div>
                    <div class="agent-name">EventModeler</div>
                    <div class="agent-role">Event Sourcing Design Agent</div>
                    <div class="agent-desc">Designs event schemas, models aggregates, identifies bounded contexts, and helps migrate from CRUD to event-sourced systems.</div>
                    <ul class="agent-caps">
                        <li><span class="icon">‚ú¶</span> Event schema design</li>
                        <li><span class="icon">‚ú¶</span> Aggregate boundary identification</li>
                        <li><span class="icon">‚ú¶</span> Projection/read model design</li>
                        <li><span class="icon">‚ú¶</span> Migration planning from CRUD</li>
                        <li><span class="icon">‚ú¶</span> Event versioning strategy</li>
                        <li><span class="icon">‚ú¶</span> Snapshot optimization</li>
                    </ul>
                </div>
                <div class="code-panel">
                    <div class="code-header">
                        <div class="code-tab">Event Modeler</div>
                        <div class="code-filename">event_modeler.py</div>
                    </div>
                    <div class="code-content">
                        <pre><span class="code-comment"># event_modeler.py</span>
<span class="code-keyword">from</span> crewai <span class="code-keyword">import</span> Agent, Task, Crew

event_modeler = Agent(
    <span class="code-string">role=</span><span class="code-string">"Event Sourcing Architect"</span>,
    <span class="code-string">goal=</span><span class="code-string">"Design clean event-sourced systems"</span>,
    <span class="code-string">backstory=</span><span class="code-string">"""Expert in CQRS, Event Sourcing,
    DDD aggregates, and event schema design.
    Deep knowledge of EventStoreDB, Marten."""</span>,
    <span class="code-string">tools=</span>[event_designer, aggregate_analyzer,
           projection_builder, migration_planner]
)

design_task = Task(
    <span class="code-string">description=</span><span class="code-string">"""Model events for:
    {domain_description}
    
    Design aggregates, events, and projections
    for an event-sourced implementation."""</span>,
    <span class="code-string">agent=</span>event_modeler
)</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- RELATED -->
        <section class="module">
            <div class="module-header">
                <div class="module-icon">üîó</div>
                <div class="module-info">
                    <h2>Related Pages</h2>
                    <p>Continue exploring</p>
                </div>
            </div>

            <div class="related-grid">
                <a href="cat09-p2-event-driven.html" class="related-card">
                    <div class="related-num">Page 9.2</div>
                    <div class="related-title">Event-Driven Architecture</div>
                    <div class="related-desc">Asynchronous messaging patterns</div>
                </a>
                <a href="cat09-p7-domain-driven.html" class="related-card">
                    <div class="related-num">Page 9.7</div>
                    <div class="related-title">Domain-Driven Design</div>
                    <div class="related-desc">Strategic and tactical DDD patterns</div>
                </a>
                <a href="cat09-p1-microservices.html" class="related-card">
                    <div class="related-num">Page 9.1</div>
                    <div class="related-title">Microservices</div>
                    <div class="related-desc">Service decomposition patterns</div>
                </a>
            </div>
        </section>

    </div>
</div>

<footer>
    <div class="footer-nav">
        <a href="cat09-p5-api-patterns.html" class="footer-link">
            <span>‚Üê</span>
            <div>
                <div class="footer-link-label">Previous Page</div>
                <div class="footer-link-title">9.5: API Patterns</div>
            </div>
        </a>
        <div class="footer-brand"><span>STRATEGY</span>HUB ‚Ä¢ Page 9.6</div>
        <a href="cat09-p7-domain-driven.html" class="footer-link">
            <div>
                <div class="footer-link-label">Next Page</div>
                <div class="footer-link-title">9.7: Domain-Driven Design</div>
            </div>
            <span>‚Üí</span>
        </a>
    </div>
</footer>

</body>
</html>
